<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Birthday! üéÇ</title>
    <link href="https://fonts.googleapis.com/css2?family=Righteous&family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh; color: white;
            display: flex; justify-content: center; align-items: center;
        }
        .bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; overflow: hidden; }
        .bg span {
            position: absolute; width: 20px; height: 20px;
            background: rgba(255, 255, 255, 0.1); animation: mv 25s linear infinite;
            bottom: -150px; border-radius: 50%;
        }
        @keyframes mv {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(-1000px) rotate(720deg); opacity: 0; }
        }
        .box { width: 100%; max-width: 600px; padding: 20px; z-index: 10; }
        .card {
            background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(16px);
            border-radius: 30px; border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 30px 20px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .cake { font-size: 3.5rem; margin-bottom: 5px; animation: bnc 1s infinite; }
        @keyframes bnc { 0%, 100% { transform: translateY(0) scale(1); } 50% { transform: translateY(-10px) scale(1.1); } }
        
        .pic { margin: 20px auto 25px; width: 200px; height: 200px; position: relative; }
        .glow {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 260px; height: 260px;
            background: radial-gradient(circle, rgba(0,150,255,0.9) 0%, rgba(0,200,255,0.6) 30%, rgba(100,200,255,0.4) 50%, transparent 75%);
            filter: blur(40px); border-radius: 50%; z-index: 1; animation: pls 3s ease-in-out infinite alternate;
        }
        @keyframes pls {
            0% { opacity: 0.7; transform: translate(-50%, -50%) scale(0.9); }
            100% { opacity: 1; transform: translate(-50%, -50%) scale(1.15); }
        }
        .frame {
            width: 100%; height: 100%; border-radius: 50%; border: 5px solid rgba(0,180,255,0.7);
            overflow: hidden; position: relative; z-index: 2;
            box-shadow: 0 0 40px rgba(0,150,255,0.9), 0 0 80px rgba(0,150,255,0.5), inset 0 0 30px rgba(0,150,255,0.3);
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            display: flex; align-items: center; justify-content: center;
        }
        .ph {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 4.5rem; z-index: 1; animation: flt 3s ease-in-out infinite;
            filter: drop-shadow(0 0 25px rgba(0,200,255,0.7)); transition: opacity 0.5s;
        }
        @keyframes flt {
            0%, 100% { transform: translate(-50%, -50%) scale(1) rotate(-5deg); }
            50% { transform: translate(-50%, -50%) scale(1.15) rotate(5deg); }
        }
        .img {
            width: 100%; height: 100%; object-fit: cover;
            position: absolute; top: 0; left: 0; opacity: 0; transition: opacity 1.5s; z-index: 3;
        }
        .img.on { opacity: 1; }

        .nm {
            font-size: 2.5rem; font-weight: 800; margin: 10px 0;
            background: linear-gradient(45deg, #ff6b6b, #feca57, #ff9ff3, #54a0ff);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            animation: flt2 3s infinite;
        }
        @keyframes flt2 { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }
        .dt {
            font-size: 1.1rem; color: #ffd700; background: rgba(255, 255, 255, 0.1);
            display: inline-block; padding: 5px 15px; border-radius: 50px; margin-bottom: 10px;
        }
        .msg {
            background: rgba(255, 255, 255, 0.08); padding: 20px; border-radius: 20px;
            margin: 10px 0; font-size: 1rem; line-height: 1.5; white-space: pre-line;
        }
        .emo { margin-top: 15px; font-size: 1.8rem; letter-spacing: 8px; }
        .e { animation: bt 1.5s ease-in-out infinite; display: inline-block; }
        @keyframes bt { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }
        
        .sh { margin-top: 15px; padding: 12px; background: rgba(255, 255, 255, 0.03); border-radius: 15px; }
        .shb { display: flex; justify-content: center; gap: 8px; flex-wrap: wrap; margin-top: 8px; }
        .sb {
            padding: 8px 15px; border-radius: 50px; text-decoration: none;
            color: white; font-size: 0.85rem; font-weight: 600; border: none; cursor: pointer;
        }
        .sb:hover { transform: scale(1.05); }
        .wa { background: #25D366; }
        .fb { background: #1877F2; }
        .cp { background: #00f0ff; color: #000; }
        .nb {
            margin-top: 15px; width: 100%; background: rgba(255,255,255,0.1);
            color: white; padding: 12px; font-size: 0.9rem; border: none;
            border-radius: 50px; cursor: pointer;
        }
        #c { position: fixed; top: 0; left: 0; pointer-events: none; z-index: 100; }
        .loading { font-size: 1.2rem; margin-top: 50px; }
        .error { color: #ff6b6b; }
    </style>
</head>
<body>
    <div class="bg">
        <span style="left:25%; width:80px; height:80px; background:rgba(255,107,107,0.15);"></span>
        <span style="left:10%; width:20px; height:20px; animation-delay:2s; background:rgba(78,205,196,0.15);"></span>
        <span style="left:70%; width:20px; height:20px; animation-delay:4s; background:rgba(255,230,109,0.15);"></span>
    </div>
    <canvas id="c"></canvas>

    <div class="box">
        <div class="card" id="content">
            <p class="loading">Loading wish... üéÇ</p>
        </div>
    </div>

    <script>
        // Configuration
        const API_URL = "https://urneinbrxacnwojhuvut.supabase.co/rest/v1/posts";
        const API_KEY = "sb_publishable_xLnFSAUTtuwpcdBjL2mu7w_k-zekj1K";
        
        let interval = null;
        
        window.onload = async () => {
            const params = new URLSearchParams(location.search);
            const wishId = params.get('id');
            
            if (!wishId) {
                showError("No wish ID provided");
                return;
            }

            try {
                // Fetch wish from database
                const res = await fetch(`${API_URL}?id=eq.${wishId}&select=*`, {
                    headers: {
                        "apikey": API_KEY,
                        "Authorization": `Bearer ${API_KEY}`
                    }
                });

                if (!res.ok) throw new Error("Failed to load wish");

                const data = await res.json();
                
                if (data.length === 0) {
                    showError("Wish not found");
                    return;
                }

                const wish = data[0];
                displayWish(wish);
                anim();

            } catch (error) {
                console.error("Error loading wish:", error);
                showError("Failed to load wish");
            }
        };

        function displayWish(wish) {
            const photos = [wish.photo_url, wish.photo_url_2].filter(p => p);
            
            // Format date
            let dateText = '';
            if (wish.birth_date) {
                const d = new Date(wish.birth_date);
                dateText = `üìÖ ${d.getDate()}/${d.getMonth()+1}/${d.getFullYear()}`;
            }

            document.getElementById('content').innerHTML = `
                <div class="cake">üéÇ</div>
                <h2 style="font-size:0.9rem; letter-spacing:3px; opacity:0.7; font-weight:400;">HAPPY BIRTHDAY</h2>
                
                <div class="pic">
                    <div class="glow"></div>
                    <div class="frame">
                        <div class="ph" id="ph">üéÇ</div>
                        <img id="i1" class="img" crossorigin="anonymous">
                        <img id="i2" class="img" crossorigin="anonymous">
                    </div>
                </div>

                <div class="nm">${wish.name}</div>
                ${dateText ? `<div class="dt">${dateText}</div>` : ''}
                <div class="msg">${wish.message}</div>
                
                <div class="emo">
                    <span class="e">üéà</span>
                    <span class="e" style="animation-delay:0.2s;">üéâ</span>
                    <span class="e" style="animation-delay:0.4s;">üéÅ</span>
                    <span class="e" style="animation-delay:0.6s;">üéä</span>
                    <span class="e" style="animation-delay:0.8s;">üíñ</span>
                </div>

                <div class="sh">
                    <p style="font-size:0.8rem; opacity:0.6;">Share this wish:</p>
                    <div class="shb">
                        <a id="wa" class="sb wa" target="_blank">WhatsApp</a>
                        <a id="fb" class="sb fb" target="_blank">Facebook</a>
                        <button onclick="copy()" class="sb cp">Copy Link</button>
                    </div>
                </div>

                <button class="nb" onclick="location.href='index.html'">Create New Wish</button>
            `;

            // Setup share buttons
            const url = location.href;
            document.getElementById('wa').href = `https://wa.me/?text=${encodeURIComponent("Birthday surprise! üéÇ " + url)}`;
            document.getElementById('fb').href = `https://facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`;

            // Load photos
            if (photos.length > 0) {
                loadPhotos(photos);
            }
        }

        function loadPhotos(urls) {
            const ph = document.getElementById('ph');
            const i1 = document.getElementById('i1');
            const i2 = document.getElementById('i2');
            
            i1.src = urls[0];
            i1.onload = () => {
                ph.style.opacity = '0';
                setTimeout(() => ph.style.display = 'none', 500);
                i1.classList.add('on');
            };
            
            if (urls.length > 1) {
                i2.src = urls[1];
                i2.onload = () => {
                    setTimeout(() => swap(i1, i2), 2000);
                };
            }
        }

        function swap(i1, i2) {
            let s = true;
            if (interval) clearInterval(interval);
            interval = setInterval(() => {
                i1.classList.toggle('on', s);
                i2.classList.toggle('on', !s);
                s = !s;
            }, 4000);
        }

        function showError(msg) {
            document.getElementById('content').innerHTML = `
                <div class="cake">üò¢</div>
                <h2 class="error">${msg}</h2>
                <button class="nb" style="margin-top: 20px;" onclick="location.href='index.html'">Go Back</button>
            `;
        }

        function copy() {
            navigator.clipboard.writeText(location.href)
                .then(() => alert("Link copied! üëç"))
                .catch(() => alert("Copy manually"));
        }

        function anim() {
            const cv = document.getElementById('c');
            const cx = cv.getContext('2d');
            cv.width = innerWidth;
            cv.height = innerHeight;
            
            const bs = [];
            for (let i = 0; i < 80; i++) {
                bs.push({
                    x: Math.random() * cv.width,
                    y: Math.random() * cv.height - cv.height,
                    w: Math.random() * 10 + 5,
                    h: Math.random() * 10 + 5,
                    c: `hsl(${Math.random() * 360}, 80%, 60%)`,
                    s: Math.random() * 3 + 2,
                    r: Math.random() * 360
                });
            }

            function dr() {
                cx.clearRect(0, 0, cv.width, cv.height);
                bs.forEach(b => {
                    cx.save();
                    cx.fillStyle = b.c;
                    cx.translate(b.x, b.y);
                    cx.rotate(b.r * Math.PI / 180);
                    cx.fillRect(-b.w/2, -b.h/2, b.w, b.h);
                    cx.restore();
                    b.y += b.s;
                    b.r += 2;
                    if (b.y > cv.height) b.y = -20;
                });
                requestAnimationFrame(dr);
            }
            dr();
        }
    </script>
</body>
</html>
